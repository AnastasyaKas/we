<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –¢–µ—Å—Ç –ª–∏—á–Ω–æ—Å—Ç–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root { --bg:#f6f7fb; --card:#fff; --text:#111; --accent:#0088cc; }
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; }
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            background: var(--bg); color: var(--text);
        }
        .wrap {
            min-height: var(--tg-viewport-height, 100dvh);
            min-height: 100dvh; /* fallback */
            min-height: 100vh;  /* older browsers */
            padding: calc(env(safe-area-inset-top,0px) + 16px) 16px calc(env(safe-area-inset-bottom,0px) + 16px);
            display: grid; place-items: start center;
        }
        .card {
            width: 100%; max-width: 560px; background: var(--card);
            border-radius: 16px; padding: 20px; box-shadow: 0 6px 18px rgba(0,0,0,.06);
        }
        .title { margin: 0 0 12px; font-size: 22px; }
        .muted { color:#666; margin: 0 0 16px; }
        .btn {
            width: 100%; padding: 12px 14px; border: 0; border-radius: 10px;
            background: var(--accent); color: #fff; font-size: 16px; cursor: pointer;
        }
        .btn:hover { filter: brightness(.95); }
        .btn.alt {
            background:#e9eef3; color:#0f172a;
        }
        .answers { display: grid; gap: 10px; margin-top: 14px; }
        .progress { font-size: 14px; color:#556; margin-bottom: 8px; }
        .pill {
            display:inline-block; font-size:12px; padding:6px 10px; border-radius:999px; background:#eef3f7; color:#223;
            margin: 6px 6px 0 0;
        }
        .result-title { font-size: 20px; margin: 6px 0 8px; }
        .result-desc { color:#334155; line-height:1.5; }
        .center { text-align:center; }
        .spacer { height: 8px; }
    </style>
</head>
<body>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<div class="wrap">
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="home" class="card">
        <h2 class="title">–ü—Ä–∏–≤–µ—Ç üëã</h2>
        <p class="muted">–ù–∞–∂–º–∏ –Ω–∞ –ø–ª–∞—à–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç –∏–∑ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏.</p>
        <button class="btn" id="startBtn">üß≠ –¢–µ—Å—Ç: ¬´–ö–∞–∫–∞—è —Ç—ã –ª–∏—á–Ω–æ—Å—Ç—å?¬ª</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ç–µ—Å—Ç–∞ -->
    <div id="quiz" class="card" style="display:none;">
        <div class="progress" id="progress"></div>
        <h3 class="title" id="question"></h3>
        <div class="answers" id="answers"></div>
        <div class="spacer"></div>
        <button class="btn alt" id="backBtn" style="display:none;">‚Üê –ù–∞–∑–∞–¥</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div id="result" class="card" style="display:none;">
        <div class="center">
            <div class="pill" id="scorePills"></div>
        </div>
        <h3 class="result-title" id="resultTitle"></h3>
        <p class="result-desc" id="resultText"></p>
        <div class="spacer"></div>
        <button class="btn" id="retryBtn">–ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞</button>
    </div>
</div>

<script>
    // --- Telegram Mini App init ---
    const tg = window.Telegram?.WebApp;
    if (tg) {
        tg.ready();
        tg.expand();
        const applyHeight = () => {
            const h = (tg.viewportStableHeight || tg.viewportHeight);
            if (h) document.documentElement.style.setProperty('--tg-viewport-height', h + 'px');
        };
        applyHeight();
        tg.onEvent?.('viewportChanged', applyHeight);
    }

    // --- –ú–æ–¥–µ–ª—å —Ç–µ—Å—Ç–∞ ---
    // 4 —Ç–∏–ø–∞ –ª–∏—á–Ω–æ—Å—Ç–∏: A=–ê–Ω–∞–ª–∏—Ç–∏–∫, C=–¢–≤–æ—Ä–µ—Ü, L=–õ–∏–¥–µ—Ä, E=–≠–º–ø–∞—Ç
    const TYPES = {
        A: { name: '–ê–Ω–∞–ª–∏—Ç–∏–∫',  desc: '–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî –ª–æ–≥–∏–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –õ—é–±–∏—à—å —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª—è—Ö, –∑–∞–º–µ—á–∞–µ—à—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.' },
        C: { name: '–¢–≤–æ—Ä–µ—Ü',    desc: '–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –∏–¥–µ–∏, –ª—é–±–∏—à—å –ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –∏ —Å–º–æ—Ç—Ä–µ—Ç—å —à–∏—Ä–µ —Ä–∞–º–æ–∫.' },
        L: { name: '–õ–∏–¥–µ—Ä',     desc: '–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –ë–µ—Ä—ë—à—å –Ω–∞ —Å–µ–±—è —Ä–æ–ª—å –≤–µ–¥—É—â–µ–≥–æ, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω(–∞) –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.' },
        E: { name: '–≠–º–ø–∞—Ç',     desc: '–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞. –¢–æ–Ω–∫–æ —á—É–≤—Å—Ç–≤—É–µ—à—å –ª—é–¥–µ–π, —Å–æ–∑–¥–∞—ë—à—å —Ç—ë–ø–ª—ã–µ —Å–≤—è–∑–∏ –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.' },
    };

    const questions = [
        {
            q: '–ö–æ–≥–¥–∞ –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞, —Ç—ã –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å‚Ä¶',
            options: [
                { t: 'A', text: '–†–∞–∑–±–∏–≤–∞—é –Ω–∞ —à–∞–≥–∏ –∏ –ø–ª–∞–Ω' },
                { t: 'C', text: '–ü—Ä–∏–¥—É–º—ã–≤–∞—é –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥' },
                { t: 'L', text: '–û–ø—Ä–µ–¥–µ–ª—è—é, –∫—Ç–æ –∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç' },
                { t: 'E', text: '–û–±—Å—É–∂–¥–∞—é —Å –ª—é–¥—å–º–∏, —Å–æ–±–∏—Ä–∞—é –º–Ω–µ–Ω–∏—è' },
            ]
        },
        {
            q: '–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã —Ç–µ–±–µ –±–ª–∏–∂–µ?',
            options: [
                { t: 'L', text: '–¶–µ–ª—å ‚Üí –¥–µ–¥–ª–∞–π–Ω—ã ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç' },
                { t: 'E', text: '–ö–æ–º–∞–Ω–¥–Ω–æ, –≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–π —Å—Ä–µ–¥–µ' },
                { t: 'A', text: '–°–ø–æ–∫–æ–π–Ω–æ –∏ –≥–ª—É–±–æ–∫–æ, —Å –∞–Ω–∞–ª–∏–∑–æ–º' },
                { t: 'C', text: '–ì–∏–±–∫–æ, —Å –º–µ—Å—Ç–æ–º –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤' },
            ]
        },
        {
            q: '–ï—Å–ª–∏ –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ, —Ç—ã –æ–±—ã—á–Ω–æ‚Ä¶',
            options: [
                { t: 'A', text: '–°–æ–±–∏—Ä–∞—é –∫–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ä–µ—à–∞—é' },
                { t: 'L', text: '–ë–µ—Ä—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª—è—é' },
                { t: 'C', text: '–ò—â—É —Å–∞–º—ã–π –∏–∑—è—â–Ω—ã–π/–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —Ö–æ–¥' },
                { t: 'E', text: '–°–ø—Ä–∞—à–∏–≤–∞—é –ø–æ–¥–¥–µ—Ä–∂–∫—É/—Å–æ–≤–µ—Ç —É –ª—é–¥–µ–π' },
            ]
        },
        {
            q: '–ß—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ —Ç–µ–±—è –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç?',
            options: [
                { t: 'C', text: '–ò–¥–µ–∏, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–≤–æ—Ä–∏—Ç—å' },
                { t: 'L', text: '–ê–º–±–∏—Ü–∏–æ–∑–Ω—ã–µ —Ü–µ–ª–∏ –∏ –≤–ª–∏—è–Ω–∏–µ' },
                { t: 'A', text: '–ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è—Å–Ω–æ—Å—Ç—å' },
                { t: 'E', text: '–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å –¥–ª—è –ª—é–¥–µ–π –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ' },
            ]
        },
        {
            q: '–ö–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–æ–≤?',
            options: [
                { t: 'E', text: '–°–Ω–∞—á–∞–ª–∞ –ø–æ—á—É–≤—Å—Ç–≤—É—é –∫–æ–º–∞–Ω–¥—É/–∫–ª–∏–µ–Ω—Ç–∞' },
                { t: 'L', text: '–ë—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ—Å—Ç—Ä–æ—é —Ä–æ–ª–∏ –∏ –∫—É—Ä—Å' },
                { t: 'C', text: '–ò—Å–ø–æ–ª—å–∑—É—é —à–∞–Ω—Å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ' },
                { t: 'A', text: '–ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä—É—é —Å —É—á—ë—Ç–æ–º —Ä–∏—Å–∫–æ–≤' },
            ]
        },
    ];

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ ---
    let step = 0;
    const scores = { A:0, C:0, L:0, E:0 };
    const answersStack = []; // –¥–ª—è –∫–Ω–æ–ø–∫–∏ ¬´–ù–∞–∑–∞–¥¬ª

    // --- –£–∑–ª—ã ---
    const home = document.getElementById('home');
    const quiz = document.getElementById('quiz');
    const result = document.getElementById('result');
    const startBtn = document.getElementById('startBtn');
    const backBtn = document.getElementById('backBtn');
    const retryBtn = document.getElementById('retryBtn');
    const qEl = document.getElementById('question');
    const answersEl = document.getElementById('answers');
    const progressEl = document.getElementById('progress');
    const resultTitleEl = document.getElementById('resultTitle');
    const resultTextEl = document.getElementById('resultText');
    const scorePillsEl = document.getElementById('scorePills');

    startBtn.onclick = () => {
        resetQuiz();
        home.style.display = 'none';
        quiz.style.display = 'block';
        renderStep();
    };
    backBtn.onclick = () => goBack();
    retryBtn.onclick = () => {
        result.style.display = 'none';
        home.style.display = 'block';
    };

    function resetQuiz() {
        step = 0;
        scores.A = scores.C = scores.L = scores.E = 0;
        answersStack.length = 0;
        backBtn.style.display = 'none';
    }

    function renderStep() {
        const total = questions.length;
        if (step >= total) return showResult();

        const item = questions[step];
        progressEl.textContent = `–í–æ–ø—Ä–æ—Å ${step + 1} –∏–∑ ${total}`;
        qEl.textContent = item.q;

        answersEl.innerHTML = '';
        item.options.forEach((opt) => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = opt.text;
            btn.onclick = () => {
                scores[opt.t] += 1;
                answersStack.push(opt.t);
                step += 1;
                backBtn.style.display = step > 0 ? 'block' : 'none';
                renderStep();
            };
            answersEl.appendChild(btn);
        });
    }

    function goBack() {
        if (step === 0) return;
        const last = answersStack.pop();
        if (last) scores[last] -= 1;
        step -= 1;
        backBtn.style.display = step > 0 ? 'block' : 'none';
        renderStep();
    }

    function showResult() {
        quiz.style.display = 'none';
        result.style.display = 'block';

        // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        const entries = Object.entries(scores); // [[A,2],[C,1]...]
        entries.sort((a,b) => b[1]-a[1]);
        const [topKey, topScore] = entries[0];

        // –Ω–∞ —Å–ª—É—á–∞–π —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤
        const topKeys = entries.filter(([_, s]) => s === topScore).map(([k]) => k);
        let title, desc;
        if (topKeys.length === 1) {
            title = TYPES[topKey].name;
            desc  = TYPES[topKey].desc;
        } else {
            title = topKeys.map(k => TYPES[k].name).join(' + ');
            desc  = '–í —Ç–µ–±–µ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã—Ö —Ä–æ–ª–µ–π: ' +
                topKeys.map(k => TYPES[k].name.toLowerCase()).join(', ') +
                '. –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ –∫–∞–∫ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –≤ —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö.';
        }

        resultTitleEl.textContent = `–¢–≤–æ–π —Ç–∏–ø: ${title}`;
        resultTextEl.textContent  = desc;

        // –º–∏–Ω–∏-—Å–≤–æ–¥–∫–∞ –±–∞–ª–ª–æ–≤
        scorePillsEl.innerHTML =
            `<span class="pill">–ê–Ω–∞–ª–∏—Ç–∏–∫: ${scores.A}</span>` +
            `<span class="pill">–¢–≤–æ—Ä–µ—Ü: ${scores.C}</span>` +
            `<span class="pill">–õ–∏–¥–µ—Ä: ${scores.L}</span>` +
            `<span class="pill">–≠–º–ø–∞—Ç: ${scores.E}</span>`;

        // (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—Ç—É –≤ —á–∞—Ç:
        // tg?.sendData && tg.sendData(JSON.stringify({ type:'personality_result', title, scores }));
    }
</script>
</body>
</html>
